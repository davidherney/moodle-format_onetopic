{"version":3,"file":"onetopicbackground.min.js","sources":["../src/onetopicbackground.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Onetopic background selector.\n *\n * @module    format_onetopic/onetopicbackground\n * @copyright 2021 David Herney Bernal - cirano\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport ModalFactory from 'core/modal_factory';\nimport ModalSaveCancel from 'core/modal_save_cancel';\nimport ModalEvents from 'core/modal_events';\n\n/**\n * Component initialization.\n *\n * @method init\n * @param {String} controlid The control id.\n */\nexport const init = (controlid) => {\n\n    var $controlinput = $('#' + controlid);\n    var $control = $controlinput.parent('.backgroundpicker');\n    var $controlwindow = $control.find('.backgroundpickerwindow');\n    var $controlbutton = $control.find('.backgroundpickerselector');\n    var $colorpickerinput = $controlwindow.find('input.form-control[type=\"text\"]');\n\n    $controlinput.on('change', function() {\n        var $color = $controlinput.val();\n        if ($color) {\n            $controlinput.css('background', $color);\n        } else {\n            $controlinput.css('background', '');\n        }\n    });\n    $controlinput.trigger('change');\n\n    // Initialize the modal window.\n    var title = $controlwindow.attr('title');\n    var buttons = [];\n    buttons.save = $controlwindow.data('savelabel');\n\n    var setEvents = function(modal) {\n        modal.getRoot().on(ModalEvents.cancel, () => {\n            modal.hide();\n        });\n\n        modal.getRoot().on(ModalEvents.save, () => {\n            var newcolor = $colorpickerinput.val();\n            var val = $controlinput.val();\n            var color = readColor(val);\n            if (color) {\n                val = val.replace(color, newcolor);\n            } else if (val.trim() === '') {\n                val = newcolor;\n            } else {\n                val += ' ' + newcolor;\n            }\n            $controlinput.val(val);\n            $controlinput.css('background', val);\n            modal.hide();\n        });\n    };\n\n    ModalFactory.create({\n        'title': title,\n        'body': $controlwindow,\n        'type': ModalSaveCancel.TYPE,\n        'large': true,\n        'buttons': buttons\n    })\n    .done(function(modal) {\n        var $modalBody = modal.getBody();\n        $modalBody.append($controlwindow);\n        $control.data('modal', modal);\n        setEvents(modal);\n    });\n\n    // Color picker control.\n    $controlbutton.on('click', function(e) {\n        e.preventDefault();\n        $controlwindow.removeClass('hidden');\n        var currentval = $controlinput.val();\n\n        var color = readColor(currentval);\n\n        $colorpickerinput.val(color);\n        $control.data('modal').show();\n    });\n\n};\n\n/**\n * Extracts the first color from a text string. Recognizes hexadecimal, rgba and hsla.\n *\n * @param {string} text\n * @returns\n */\nvar readColor = function(text) {\n    var regexcolor = new RegExp(\n        /#[0-9a-fA-F]{6}/.source\n        + /|#[0-9a-fA-F]{3}/.source\n        + /|rgba?\\(\\s*([0-9]{1,3}\\s*,\\s*){2}[0-9]{1,3}\\s*(,\\s*[0-9.]+\\s*)?\\)/.source\n        + /|hsla?\\(\\s*([0-9]{1,3}\\s*,\\s*){2}[0-9]{1,3}\\s*(,\\s*[0-9.]+\\s*)?\\)/.source);\n\n    var color = text.match(regexcolor);\n    if (color) {\n        color = color[0];\n    }\n\n    return color;\n};\n"],"names":["controlid","$controlinput","$control","parent","$controlwindow","find","$controlbutton","$colorpickerinput","on","$color","val","css","trigger","title","attr","buttons","save","data","create","ModalSaveCancel","TYPE","done","modal","getBody","append","getRoot","ModalEvents","cancel","hide","newcolor","color","readColor","replace","trim","setEvents","e","preventDefault","removeClass","currentval","show","text","regexcolor","RegExp","source","match"],"mappings":";;;;;;;gTAiCqBA,gBAEbC,eAAgB,mBAAE,IAAMD,WACxBE,SAAWD,cAAcE,OAAO,qBAChCC,eAAiBF,SAASG,KAAK,2BAC/BC,eAAiBJ,SAASG,KAAK,6BAC/BE,kBAAoBH,eAAeC,KAAK,mCAE5CJ,cAAcO,GAAG,UAAU,eACnBC,OAASR,cAAcS,MACvBD,OACAR,cAAcU,IAAI,aAAcF,QAEhCR,cAAcU,IAAI,aAAc,OAGxCV,cAAcW,QAAQ,cAGlBC,MAAQT,eAAeU,KAAK,SAC5BC,QAAU,GACdA,QAAQC,KAAOZ,eAAea,KAAK,oCAwBtBC,OAAO,OACPL,WACDT,oBACAe,2BAAgBC,YACf,UACEL,UAEdM,MAAK,SAASC,OACMA,MAAMC,UACZC,OAAOpB,gBAClBF,SAASe,KAAK,QAASK,OAhCX,SAASA,OACrBA,MAAMG,UAAUjB,GAAGkB,sBAAYC,QAAQ,KACnCL,MAAMM,UAGVN,MAAMG,UAAUjB,GAAGkB,sBAAYV,MAAM,SAC7Ba,SAAWtB,kBAAkBG,MAC7BA,IAAMT,cAAcS,MACpBoB,MAAQC,UAAUrB,KAClBoB,MACApB,IAAMA,IAAIsB,QAAQF,MAAOD,UACH,KAAfnB,IAAIuB,OACXvB,IAAMmB,SAENnB,KAAO,IAAMmB,SAEjB5B,cAAcS,IAAIA,KAClBT,cAAcU,IAAI,aAAcD,KAChCY,MAAMM,UAeVM,CAAUZ,UAIdhB,eAAeE,GAAG,SAAS,SAAS2B,GAChCA,EAAEC,iBACFhC,eAAeiC,YAAY,cACvBC,WAAarC,cAAcS,MAE3BoB,MAAQC,UAAUO,YAEtB/B,kBAAkBG,IAAIoB,OACtB5B,SAASe,KAAK,SAASsB,eAW3BR,UAAY,SAASS,UACjBC,WAAa,IAAIC,OACjB,kBAAkBC,OAChB,mBAAmBA,OACnB,oEAAoEA,OACpE,oEAAoEA,QAEtEb,MAAQU,KAAKI,MAAMH,mBACnBX,QACAA,MAAQA,MAAM,IAGXA"}