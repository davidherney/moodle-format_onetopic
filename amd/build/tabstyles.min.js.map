{"version":3,"file":"tabstyles.min.js","sources":["../src/tabstyles.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tab editor in site settings.\n *\n * @module    format_onetopic/tabstyles\n * @copyright 2021 David Herney Bernal - cirano\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport ModalFactory from 'core/modal_factory';\n\nvar $tabstyles = null;\nvar $styleswindow = null;\nvar currenttype = 'default';\nvar globalstyles = {};\nvar $inputtosave = null;\n\n/**\n * Component initialization.\n *\n * @method init\n */\nexport const init = () => {\n\n    $tabstyles = $('#onetopic-tabstyles');\n    $inputtosave = $tabstyles.find('textarea.savecontrol');\n    $styleswindow = $('#onetopic-styleswindow');\n\n    // Define the tab icons.\n    $('#onetopic-tabstyles .tpl-tabdefault .tabicon').each(function() {\n        var $tabicon = $(this);\n        $tabicon.append('<span class=\"tabicon-default hidden\"></span>');\n        $tabicon.append('<span class=\"tabicon-hover hidden\"></span>');\n    });\n\n    $('#onetopic-tabstyles .tpl-tabactive .tabicon').each(function() {\n        var $tabicon = $(this);\n        $tabicon.append('<span class=\"tabicon-active hidden\"></span>');\n        $tabicon.append('<span class=\"tabicon-hover hidden\"></span>');\n    });\n\n    $('#onetopic-tabstyles .tpl-tabparent .tabicon').each(function() {\n        var $tabicon = $(this);\n        $tabicon.append('<span class=\"tabicon-parent hidden\"></span>');\n        $tabicon.append('<span class=\"tabicon-default hidden\"></span>');\n        $tabicon.append('<span class=\"tabicon-hover hidden\"></span>');\n    });\n\n    $('#onetopic-tabstyles .tpl-tabchildindex .tabicon').each(function() {\n        var $tabicon = $(this);\n        $tabicon.append('<span class=\"tabicon-childs hidden\"></span>');\n        $tabicon.append('<span class=\"tabicon-childindex hidden\"></span>');\n        $tabicon.append('<span class=\"tabicon-default hidden\"></span>');\n        $tabicon.append('<span class=\"tabicon-hover hidden\"></span>');\n    });\n\n    $('#onetopic-tabstyles .tpl-tabchild .tabicon').each(function() {\n        var $tabicon = $(this);\n        $tabicon.append('<span class=\"tabicon-childs hidden\"></span>');\n        $tabicon.append('<span class=\"tabicon-default hidden\"></span>');\n        $tabicon.append('<span class=\"tabicon-hover hidden\"></span>');\n    });\n\n    $('#onetopic-tabstyles .tpl-tabhighlighted .tabicon').each(function() {\n        var $tabicon = $(this);\n        $tabicon.append('<span class=\"tabicon-highlighted hidden\"></span>');\n        $tabicon.append('<span class=\"tabicon-default hidden\"></span>');\n        $tabicon.append('<span class=\"tabicon-hover hidden\"></span>');\n    });\n\n    $('#onetopic-tabstyles .tpl-tabdisabled .tabicon').each(function() {\n        var $tabicon = $(this);\n        $tabicon.append('<span class=\"tabicon-disabled hidden\"></span>');\n    });\n\n    $('#onetopic-tabstyles .tabicon').each(function() {\n        $(this).removeClass('hidden');\n    });\n    // End of Define the tab icons.\n\n    if ($inputtosave.val().trim() !== '') {\n\n        try {\n            globalstyles = JSON.parse($inputtosave.val());\n\n            if (globalstyles === null) {\n                globalstyles = {};\n            }\n        } catch (e) {\n            // eslint-disable-next-line no-console\n            console.error(e);\n            globalstyles = {};\n        }\n\n        applyStyles();\n    }\n\n    var $colorpicker = $styleswindow.find('.colorpicker');\n    var $setcolor = $colorpicker.find('[data-action=\"setcolor\"]');\n    var $colorpickerinput = $colorpicker.find('input');\n\n    // Color picker control.\n    $styleswindow.find('[data-control=\"colorpicker\"]').on('click', function() {\n        var $node = $(this);\n\n        $colorpicker.show();\n        $colorpickerinput.val($node.val());\n        $setcolor.data('target', $node);\n    }).on('change', function() {\n        var $node = $(this);\n        var color = $node.val().trim();\n\n        $node.css('background-color', color);\n    });\n\n    $setcolor.on('click', function(e) {\n        e.preventDefault();\n\n        $colorpicker.hide();\n        $setcolor.data('target').val($colorpickerinput.val()).trigger('change');\n    });\n\n    $colorpicker.find('[data-action=\"cancel\"]').on('click', function() {\n        $colorpicker.hide();\n    });\n\n    var title = $styleswindow.data('title');\n\n    // Initialize the modal window.\n    ModalFactory.create({\n        'title': title,\n        'body': ''\n    }).done(function(modal) {\n        var $modalBody = modal.getBody();\n        $styleswindow.show();\n        $modalBody.append($styleswindow);\n        $styleswindow.data('modal', modal);\n    });\n\n    // Save the styles.\n    $styleswindow.find('[data-action=\"cancelstyles\"]').on('click', function() {\n        $styleswindow.data('modal').hide();\n    });\n\n    $styleswindow.find('[data-action=\"setstyles\"]').on('click', function() {\n        var modal = $styleswindow.data('modal');\n        var newstyles = {};\n\n        $styleswindow.find('[data-style]').each(function() {\n            var $node = $(this);\n            var key = $node.data('style');\n            var value = $node.val();\n\n            if (value !== '') {\n                newstyles[key] = value;\n            }\n        });\n\n        globalstyles[currenttype] = newstyles;\n        $inputtosave.val(JSON.stringify(globalstyles));\n        applyStyles();\n\n        modal.hide();\n    });\n\n    var types = ['default', 'active', 'parent', 'highlighted', 'disabled', 'hover', 'childs', 'childindex'];\n    types.forEach(type => {\n        $('#onetopic-tabstyles #tabstyleset' + type).on('click', function(e) {\n            e.preventDefault();\n            showStylesWindow(type);\n        });\n    });\n\n    $('#onetopic-tabstyles #tabstyleclear').on('click', function(e) {\n        e.preventDefault();\n        globalstyles = {};\n        $inputtosave.val('');\n        applyStyles();\n    });\n\n    $('#tabstylesdisplay').on('click', function(e) {\n        e.preventDefault();\n        $tabstyles.toggleClass('hidden');\n    });\n\n    $('#onetopic-styleswindow .onetopic-selecticon').each(function() {\n        var $selecticon = $(this);\n        $selecticon.find('button').on('click', function(e) {\n            e.preventDefault();\n            $selecticon.find('.listicons').removeClass('hidden');\n        });\n\n        $selecticon.find('.listicons span').on('click', function(e) {\n            e.preventDefault();\n            var $icon = $(this);\n            $selecticon.find('.iconselected').html($icon.html());\n            $selecticon.find('[data-style=\"tabicon\"]').val($icon.data('value'));\n            $selecticon.find('.listicons').addClass('hidden');\n        });\n\n        $selecticon.find('[data-style=\"tabicon\"]').on('change', function() {\n            var $node = $(this);\n\n            if ($node.val() === '') {\n                $selecticon.find('.iconselected').html('');\n                return;\n            }\n\n            var $icon = $selecticon.find('.listicons span[data-value=\"' + $node.val() + '\"]');\n\n            if ($icon.length > 0) {\n                $selecticon.find('.iconselected').html($icon.html());\n            }\n        });\n    });\n\n};\n\n/**\n * Show the styles window.\n *\n * @param {string} type\n */\nvar showStylesWindow = function(type) {\n\n    currenttype = type;\n    $styleswindow.find('[data-style]').each(function() {\n        var $node = $(this);\n\n        if ($node.is('input[type=\"text\"]') || $node.is('input[type=\"hidden\"]')) {\n            $node.val('');\n            $node.trigger('change');\n        } else if ($node.is('select')) {\n            $node.find('option').first().prop('selected', true);\n        }\n    });\n\n    if (globalstyles[type] !== undefined) {\n        var currentstyles = globalstyles[type];\n\n        Object.entries(currentstyles).forEach(([key, value]) => {\n            $styleswindow.find('[data-style=\"' + key + '\"]').val(value);\n\n            // Apply the color.\n            $styleswindow.find('[data-control=\"colorpicker\"]').trigger('change');\n\n            // Change the icon.\n            $styleswindow.find('[data-style=\"tabicon\"]').trigger('change');\n        });\n    }\n\n    $styleswindow.data('modal').show();\n\n};\n\n/**\n * Apply the styles to the tabs for check current visualization.\n */\nvar applyStyles = function() {\n\n    var withunits = ['font-size', 'line-height', 'margin', 'padding', 'border-width', 'border-radius'];\n    var csscontent = '';\n\n    Object.entries(globalstyles).forEach(([type, styles]) => {\n\n        switch (type) {\n            case 'active':\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item a.nav-link.active, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs a.nav-link.active, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs a.nav-link.active, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic a.nav-link.active';\n            break;\n            case 'parent':\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item.haschilds a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs .nav-item.haschilds a.nav-link';\n            break;\n            case 'highlighted':\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item.marker a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs .nav-item.marker a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.marker a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic.marker a.nav-link';\n            break;\n            case 'disabled':\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item.disabled a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs .nav-item.disabled a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.disabled a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic.disabled a.nav-link';\n            break;\n            case 'hover':\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item a.nav-link:hover, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs .nav-item a.nav-link:hover, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item a.nav-link:hover, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic a.nav-link:hover';\n            break;\n            case 'childs':\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic a.nav-link';\n            break;\n            case 'childindex':\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic.tab_initial a.nav-link';\n            break;\n            default:\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs a.nav-link';\n        }\n\n        csscontent += '{';\n        var units = [];\n        var stylesarray = Object.entries(styles);\n\n        // Check if exist units for some rules.\n        stylesarray.forEach(([key, value]) => {\n            // Check if the key start with the units prefix.\n            if (key.indexOf('unit-') === 0) {\n\n                // Remove the prefix.\n                key = key.replace('unit-', '');\n                units[key] = value;\n            } else if (key == 'tabicon') {\n                if (value !== '') {\n                    var icon = $('#onetopic-styleswindow .listicons span[data-value=\"' + value + '\"]').html();\n                    $('#onetopic-tabstyles .tabicon-' + type).html(icon).removeClass('hidden');\n                }\n            }\n        });\n\n        stylesarray.forEach(([key, value]) => {\n\n            // Exclude the tab icons and units rules.\n            if (key.indexOf('unit-') === 0) {\n                return;\n            } else if (key == 'tabicon') {\n                return;\n            }\n\n            // If exist a unit for the rule, apply it.\n            if (units[key] !== undefined) {\n                value = value + units[key];\n            } else if (withunits.indexOf(key) !== -1) {\n                // If the rule need units, apply px by default.\n                value = value + 'px';\n            }\n\n            if (key == 'others') {\n                csscontent += value + ';';\n            } else {\n                csscontent += key + ':' + value + ';';\n            }\n        });\n        csscontent += '}';\n    });\n\n    var $stylecontainer = $tabstyles.find('style');\n\n    if ($stylecontainer.length > 0) {\n        $stylecontainer.remove();\n    }\n\n    $stylecontainer = $('<style type=\"text/css\">' + csscontent + '</style>');\n    $tabstyles.append($stylecontainer);\n\n};\n"],"names":["$tabstyles","$styleswindow","currenttype","globalstyles","$inputtosave","find","each","$tabicon","this","append","removeClass","val","trim","JSON","parse","e","console","error","applyStyles","$colorpicker","$setcolor","$colorpickerinput","on","$node","show","data","color","css","preventDefault","hide","trigger","title","create","done","modal","$modalBody","getBody","newstyles","key","value","stringify","forEach","type","showStylesWindow","toggleClass","$selecticon","$icon","html","addClass","length","is","first","prop","undefined","currentstyles","Object","entries","_ref","withunits","csscontent","_ref2","styles","units","stylesarray","_ref3","indexOf","replace","icon","_ref4","$stylecontainer","remove"],"mappings":"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"}