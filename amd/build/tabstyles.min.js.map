{"version":3,"file":"tabstyles.min.js","sources":["../src/tabstyles.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tab editor in site settings.\n *\n * @module    format_onetopic/tabstyles\n * @copyright 2021 David Herney Bernal - cirano\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport ModalFactory from 'core/modal_factory';\n\nvar $tabstyles = null;\nvar $styleswindow = null;\nvar currenttype = 'default';\nvar globalstyles = {};\nvar $inputtosave = null;\n\n/**\n * Component initialization.\n *\n * @method init\n */\nexport const init = () => {\n\n    $tabstyles = $('#onetopic-tabstyles');\n    $inputtosave = $tabstyles.find('textarea.savecontrol');\n    $styleswindow = $('#onetopic-styleswindow');\n\n    if ($inputtosave.val().trim() !== '') {\n\n        try {\n            globalstyles = JSON.parse($inputtosave.val());\n\n            if (globalstyles === null) {\n                globalstyles = {};\n            }\n        } catch (e) {\n            // eslint-disable-next-line no-console\n            console.error(e);\n            globalstyles = {};\n        }\n\n        applyStyles();\n    }\n\n    var $colorpicker = $styleswindow.find('.colorpicker');\n    var $setcolor = $colorpicker.find('[data-action=\"setcolor\"]');\n    var $colorpickerinput = $colorpicker.find('input');\n\n    // Color picker control.\n    $styleswindow.find('[data-control=\"colorpicker\"]').on('click', function() {\n        var $node = $(this);\n\n        $colorpicker.show();\n        $colorpickerinput.val($node.val());\n        $setcolor.data('target', $node);\n    }).on('change', function() {\n        var $node = $(this);\n        var color = $node.val().trim();\n\n        $node.css('background-color', color);\n    });\n\n    $setcolor.on('click', function(e) {\n        e.preventDefault();\n\n        $colorpicker.hide();\n        $setcolor.data('target').val($colorpickerinput.val()).trigger('change');\n    });\n\n    $colorpicker.find('[data-action=\"cancel\"]').on('click', function() {\n        $colorpicker.hide();\n    });\n\n    var title = $styleswindow.data('title');\n\n    // Initialize the modal window.\n    ModalFactory.create({\n        'title': title,\n        'body': ''\n    }).done(function(modal) {\n        var $modalBody = modal.getBody();\n        $styleswindow.show();\n        $modalBody.append($styleswindow);\n        $styleswindow.data('modal', modal);\n    });\n\n    // Save the styles.\n    $styleswindow.find('[data-action=\"cancelstyles\"]').on('click', function() {\n        $styleswindow.data('modal').hide();\n    });\n\n    $styleswindow.find('[data-action=\"setstyles\"]').on('click', function() {\n        var modal = $styleswindow.data('modal');\n        var newstyles = {};\n\n        $styleswindow.find('[data-style]').each(function() {\n            var $node = $(this);\n            var key = $node.data('style');\n            var value = $node.val();\n\n            if (value !== '') {\n                newstyles[key] = value;\n            }\n        });\n\n        globalstyles[currenttype] = newstyles;\n        $inputtosave.val(JSON.stringify(globalstyles));\n        applyStyles();\n\n        modal.hide();\n    });\n\n    var types = ['default', 'active', 'parent', 'highlighted', 'disabled', 'hover', 'childs', 'childindex'];\n    types.forEach(type => {\n        $('#onetopic-tabstyles #tabstyleset' + type).on('click', function(e) {\n            e.preventDefault();\n            showStylesWindow(type);\n        });\n    });\n\n    $('#onetopic-tabstyles #tabstyleclear').on('click', function(e) {\n        e.preventDefault();\n        globalstyles = {};\n        $inputtosave.val('');\n        applyStyles();\n    });\n\n    $('#tabstylesdisplay').on('click', function(e) {\n        e.preventDefault();\n\n        $tabstyles.toggleClass('hidden');\n\n    });\n\n};\n\n/**\n * Show the styles window.\n *\n * @param {string} type\n */\nvar showStylesWindow = function(type) {\n\n    currenttype = type;\n    $styleswindow.find('[data-style]').each(function() {\n        var $node = $(this);\n\n        if ($node.is('input[type=\"text\"]')) {\n            $node.val('');\n            $node.trigger('change');\n        } else if ($node.is('select')) {\n            $node.find('option').first().prop('selected', true);\n        }\n    });\n\n    if (globalstyles[type] !== undefined) {\n        var currentstyles = globalstyles[type];\n\n        Object.entries(currentstyles).forEach(([key, value]) => {\n            $styleswindow.find('[data-style=\"' + key + '\"]').val(value);\n\n            // Apply the color.\n            $styleswindow.find('[data-control=\"colorpicker\"]').trigger('change');\n        });\n    }\n\n    $styleswindow.data('modal').show();\n\n};\n\n/**\n * Apply the styles to the tabs for check current visualization.\n */\nvar applyStyles = function() {\n\n    var withunits = ['font-size', 'line-height', 'margin', 'padding', 'border-width', 'border-radius'];\n    var csscontent = '';\n\n    Object.entries(globalstyles).forEach(([type, styles]) => {\n\n        switch (type) {\n            case 'active':\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item a.nav-link.active, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs a.nav-link.active, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs a.nav-link.active, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic a.nav-link.active';\n            break;\n            case 'parent':\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item.haschilds a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs .nav-item.haschilds a.nav-link';\n            break;\n            case 'highlighted':\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item.marker a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs .nav-item.marker a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.marker a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic.marker a.nav-link';\n            break;\n            case 'disabled':\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item.disabled a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs .nav-item.disabled a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.disabled a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic.disabled a.nav-link';\n            break;\n            case 'hover':\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item a.nav-link:hover, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs .nav-item a.nav-link:hover, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item a.nav-link:hover, ';\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic a.nav-link:hover';\n            break;\n            case 'childs':\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic a.nav-link';\n            break;\n            case 'childindex':\n                csscontent += '#onetopic-tabstyles .onetopic-tab-body .nav-tabs .nav-item.subtopic.tab_initial a.nav-link';\n            break;\n            default:\n                csscontent += '#onetopic-tabstyles .verticaltabs .format_onetopic-tabs .nav-item a.nav-link, ';\n                csscontent += '#onetopic-tabstyles .nav-tabs a.nav-link';\n        }\n\n        csscontent += '{';\n        var units = [];\n        var stylesarray = Object.entries(styles);\n\n        // Check if exist units for some rules.\n        stylesarray.forEach(([key, value]) => {\n            // Check if the key start with the units prefix.\n            if (key.indexOf('unit-') === 0) {\n\n                // Remove the prefix.\n                key = key.replace('unit-', '');\n                units[key] = value;\n            }\n        });\n\n        stylesarray.forEach(([key, value]) => {\n\n            // Exclude the units rules.\n            if (key.indexOf('unit-') === 0) {\n                return;\n            }\n\n            // If exist a unit for the rule, apply it.\n            if (units[key] !== undefined) {\n                value = value + units[key];\n            } else if (withunits.indexOf(key) !== -1) {\n                // If the rule need units, apply px by default.\n                value = value + 'px';\n            }\n\n            if (key == 'others') {\n                csscontent += value + ';';\n            } else {\n                csscontent += key + ':' + value + ';';\n            }\n        });\n        csscontent += '}';\n    });\n\n    var $stylecontainer = $tabstyles.find('style');\n\n    if ($stylecontainer.length > 0) {\n        $stylecontainer.remove();\n    }\n\n    $stylecontainer = $('<style type=\"text/css\">' + csscontent + '</style>');\n    $tabstyles.append($stylecontainer);\n\n};\n"],"names":["$tabstyles","$styleswindow","currenttype","globalstyles","$inputtosave","find","val","trim","JSON","parse","e","console","error","applyStyles","$colorpicker","$setcolor","$colorpickerinput","on","$node","this","show","data","color","css","preventDefault","hide","trigger","title","create","done","modal","$modalBody","getBody","append","newstyles","each","key","value","stringify","forEach","type","showStylesWindow","toggleClass","is","first","prop","undefined","currentstyles","Object","entries","_ref","withunits","csscontent","_ref2","styles","units","stylesarray","_ref3","indexOf","replace","_ref4","$stylecontainer","length","remove"],"mappings":"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"}